<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î°úÎìúÌà¨ÏóêÏñ¥ AI Ï±óÎ¥á</title>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;700;800&display=swap" rel="stylesheet">
    <script src="https://aka.ms/csspeech/jsbrowserpackageraw"></script>
    <style>
        /* --- New Color Palette --- */
        :root {
            --main-teal: #01AAB5;
            --sub-light-yellow: #F5B800;
            --sub-deep-blue: #013780;
            --sub-action-blue: #006EEA;
            --sub-light-blue: #66ccff;
            --neutral-light-gray: #ECEDEF;
            --neutral-bg-gray: #f0f2f5;
            --neutral-white: #FFFFFF;
            --text-dark: #2c3e50;
            --error-red: #e74c3c;
            --success-green: #27ae60;
        }

        /* --- Base & Background --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', sans-serif;
            background-color: var(--neutral-bg-gray);
            background-image:
                linear-gradient(rgba(1, 170, 181, 0.07) 1px, transparent 1px),
                linear-gradient(90deg, rgba(1, 170, 181, 0.07) 1px, transparent 1px);
            background-size: 25px 25px;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- New Page Wrapper --- */
        .page-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        /* --- Language Selector (Moved) --- */
        .language-selector {
            display: flex;
            gap: 12px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .lang-icon {
            width: 40px;
            height: 40px;
            background: var(--neutral-white);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s ease-out;
            border: 2px solid transparent;
        }

        .lang-icon:hover {
            transform: scale(1.1);
        }

        .lang-icon.active {
            border-color: var(--main-teal);
        }

        /* --- Main Container --- */
        .container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            background: var(--neutral-white);
            border-radius: 24px;
            padding: 30px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
            position: relative;
            z-index: 1;
            animation: fadeInFromBottom 0.8s ease-out forwards;
            overflow: hidden;
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--main-teal), var(--sub-action-blue), var(--sub-light-blue));
        }

        @keyframes fadeInFromBottom {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Header --- */
        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            color: var(--sub-deep-blue);
            margin-bottom: 10px;
            font-weight: 800;
            line-height: 1.3;
            text-align: center;
            word-break: keep-all;
        }
        @media (max-width: 480px) {
        .header h1 {
            font-size: 1.4em;        /* Í∏∞Ï°¥ 1.8em ‚Üí Îçî ÏûëÍ≤å */
            line-height: 1.3;        /* ÏÇ¥Ïßù ÎÑâÎÑâÌïòÍ≤å */
            word-break: keep-all;
        }
            
        
        .header .subtitle {
            font-size: 0.95em;       /* Í∏∞Ï°¥ 1.1em ‚Üí Îçî ÏûëÍ≤å */
            font-weight: 500;
            color: #7f8c8d;
        }}

        /* --- Service Tabs --- */
        .service-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .service-tab {
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 700;
            border-radius: 50px;
            border: 2px solid var(--neutral-light-gray);
            background: var(--neutral-light-gray);
            color: var(--text-dark);
        }

        .service-tab:hover {
            transform: translateY(-2px);
            border-color: var(--main-teal);
        }

        .service-tab.active {
            background: var(--main-teal);
            color: var(--neutral-white);
            border-color: var(--main-teal);
        }
        
        /* --- Status Indicator --- */
        .status-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 25px;
            padding: 12px 15px;
            background: #e6f6f5;
            border-radius: 15px;
            color: #016a6e;
            font-size: 14px;
            font-weight: 700;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            background: var(--main-teal);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(1, 170, 181, 0.7); }
            50% { box-shadow: 0 0 0 5px rgba(1, 170, 181, 0); }
        }

        /* --- Quick Questions --- */
        .quick-questions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .quick-question {
            padding: 18px 20px;
            background: var(--neutral-white);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 15px;
            font-weight: 700;
            color: var(--text-dark);
            border: 1px solid var(--neutral-light-gray);
            text-align: left;
            position: relative;
            overflow: hidden;
            border-left: 5px solid;
        }
        
        .quick-question.parking { border-color: var(--sub-action-blue); }
        .quick-question.facility { border-color: var(--main-teal); }
        .quick-question.flight { border-color: var(--sub-light-blue); }
        .quick-question.mixed { border-color: var(--sub-light-yellow); }

        .quick-question:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
        }
        
        .quick-question span { margin-right: 10px; }

        /* --- Chat Area --- */
        .chat-container {
            height: 400px;
            overflow-y: auto;
            overflow-x: hidden;
            border-radius: 20px;
            padding: 10px 20px;
            margin-bottom: 20px;
            background: var(--neutral-light-gray);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .chat-container::-webkit-scrollbar { width: 8px; }
        .chat-container::-webkit-scrollbar-track { background: transparent; }
        .chat-container::-webkit-scrollbar-thumb { background: #d0d3d6; border-radius: 10px; }
        
        .message {
            padding: 12px 18px;
            border-radius: 18px;
            max-width: 80%;
            animation: fadeIn 0.5s ease-out;
            line-height: 1.6;
            word-break: break-word;
            white-space: pre-wrap;
            box-sizing: border-box; 
        }
        
        .user-message {
            background: linear-gradient(135deg, var(--sub-action-blue), var(--sub-light-blue));
            color: var(--neutral-white);
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }
        
        .bot-message-wrapper {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            align-self: flex-start;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
        }
        
        .bot-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--main-teal);
            color: var(--neutral-white);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 0;
            font-size: 18px;
        }

        .bot-message {
            background: var(--neutral-white);
            color: var(--text-dark);
            border-bottom-left-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            flex: 1;
            min-width: 0;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            max-width: 100%;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .typing-indicator span {
            width: 8px; height: 8px;
            background-color: #9E9E9E;
            border-radius: 50%;
            animation: typing 1.4s infinite both;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }
        
        /* --- Input Area --- */
        .input-container { 
            display: flex; 
            gap: 10px;
            flex-wrap: nowrap;
            align-items: center;
        }
        
        #questionInput {
            flex: 1;
            padding: 15px 25px;
            border: 2px solid var(--neutral-light-gray);
            border-radius: 30px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s;
            background: var(--neutral-white);
            color: var(--text-dark);
        }
        
        #questionInput::placeholder { color: #99a1ab; }
        #questionInput:focus {
            border-color: var(--main-teal);
            box-shadow: 0 0 0 3px rgba(1, 170, 181, 0.1);
        }

        /* --- Voice Button --- */
        .voice-button {
            width: 50px;
            height: 50px;
            background: var(--neutral-light-gray);
            border: 2px solid var(--neutral-light-gray);
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            color: var(--text-dark);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .voice-button:hover {
            transform: scale(1.05);
            border-color: var(--main-teal);
        }

        .voice-button.listening {
            background: var(--error-red);
            border-color: var(--error-red);
            color: var(--neutral-white);
            animation: voicePulse 1.5s infinite;
        }

        .voice-button.processing {
            background: var(--sub-action-blue);
            border-color: var(--sub-action-blue);
            color: var(--neutral-white);
        }

        @keyframes voicePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* --- Voice Status --- */
        .voice-status {
            position: absolute;
            top: -35px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text-dark);
            color: var(--neutral-white);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .voice-status.show {
            opacity: 1;
        }

        .voice-status::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: var(--text-dark);
        }
        
        #sendButton {
            padding: 0 25px;
            background: var(--main-teal);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 700;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(1, 170, 181, 0.2);
            min-width: 80px;
            white-space: nowrap;
            height: 50px;
        }
        
        #sendButton:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(1, 170, 181, 0.3);
        }
        #sendButton:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* --- Error Message --- */
        .error-message {
            background: var(--error-red);
            color: var(--neutral-white);
            padding: 10px 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 14px;
            display: none;
        }
        /* --- Responsive Design for Mobile --- */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                border-radius: 16px;
            }

            .input-container {
                flex-direction: row;       /* Î≤ÑÌäºÎì§ÏùÑ Í∞ÄÎ°úÎ°ú */
                flex-wrap: nowrap;         /* Î≤ÑÌäº Ï§ÑÎ∞îÍøà Î∞©ÏßÄ */
                gap: 8px;
                align-items: center;
            }
        
            #questionInput {
                font-size: 14px;
                padding: 12px 16px;
                flex: 1;
            }
        
            #sendButton,
            .voice-button {
                width: auto;
                min-width: 45px;
                height: 42px;
                font-size: 14px;
            }

            .quick-questions {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }

            .header h1 {
                font-size: 1.8em;
            }

            .header .subtitle {
                font-size: 1em;
            }

            .service-tab {
                font-size: 14px;
                padding: 8px 16px;
            }

            .chat-container {
                max-height: 60vh;
                min-height: 200px;
                height: auto;
            }

            .message {
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 1.4em;
            }

            .header .subtitle {
                font-size: 0.95em;
            }

            .quick-questions {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                gap: 10px;
            }

            .quick-question {
                font-size: 13.5px;
                padding: 14px 16px;
            }

            .chat-container {
                max-height: 60vh;
                min-height: 200px;
                height: auto;
            }

            .message {
                font-size: 13.5px;
                padding: 10px 14px;
            }

            #questionInput {
                font-size: 14px;
                padding: 12px 18px;
            }

            #sendButton,
            .voice-button {
                font-size: 14px;
                height: 42px;
            }

            .service-tab {
                font-size: 13px;
                padding: 6px 12px;
            }

            .status-indicator {
                font-size: 12.5px;
                padding: 8px 12px;
            }

            .lang-icon {
                width: 32px;
                height: 32px;
                font-size: 18px;
            }

            .bot-avatar {
                width: 32px;
                height: 32px;
                font-size: 16px;
            }

            .voice-status {
                font-size: 11px;
                top: -30px;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <div class="language-selector">
            <div class="lang-icon" data-lang="ko" onclick="changeLanguage('ko')">
            <img src="flags/kr.png" alt="Korean" width="24">
            </div>
            <div class="lang-icon" data-lang="en" onclick="changeLanguage('en')">
            <img src="flags/us.png" alt="English" width="24">
            </div>
            <div class="lang-icon" data-lang="ja" onclick="changeLanguage('ja')">
            <img src="flags/jp.png" alt="Japanese" width="24">
            </div>
            <div class="lang-icon" data-lang="zh" onclick="changeLanguage('zh')">
            <img src="flags/cn.png" alt="Chinese" width="24">
            </div>
            <div class="lang-icon" data-lang="es" onclick="changeLanguage('es')">
            <img src="flags/es.png" alt="Spanish" width="24">
            </div>
        </div>
        <div class="container">
            <div class="header">
                <h1 data-lang-key="header_title">Ïù∏Ï≤úÍµ≠Ï†úÍ≥µÌï≠ AI Ï±óÎ¥á</h1>
                <div class="subtitle" data-lang-key="header_subtitle">Ï£ºÏ∞®Ïû• ¬∑ ÏãúÏÑ§ ¬∑ Ìï≠Í≥µÌé∏ Ï†ïÎ≥¥Î•º Ìïú Î≤àÏóê!</div>
            </div>

            <div class="service-tabs">
                <div class="service-tab" data-category="all" data-lang-key="tab_all">üåü&nbsp;Ï†ÑÏ≤¥ ÏÑúÎπÑÏä§</div>
                <div class="service-tab" data-category="parking" data-lang-key="tab_parking">üöó&nbsp;Ï£ºÏ∞®Ïû•</div>
                <div class="service-tab" data-category="facility" data-lang-key="tab_facility">üè™&nbsp;ÏãúÏÑ§</div>
                <div class="service-tab" data-category="flight" data-lang-key="tab_flight">‚úàÔ∏è&nbsp;Ìï≠Í≥µÌé∏</div>
            </div>

            <div class="status-indicator">
                <div class="status-dot"></div>
                <span data-lang-key="status_text">Ïã§ÏãúÍ∞Ñ Ï†ïÎ≥¥ ÏÑúÎπÑÏä§ Ïö¥ÏòÅ Ï§ë</span>
            </div>

            <div class="error-message" id="errorMessage"></div>
            
            <div class="quick-questions" id="quickQuestions"></div>
            
            <div class="chat-container" id="chatContainer"></div>
            
            <div class="input-container">
                <input type="text" id="questionInput" onkeypress="handleKeyPress(event)">
                <button class="voice-button" id="voiceButton" onclick="toggleVoiceRecognition()">
                    <i class="fas fa-microphone"></i>
                    <div class="voice-status" id="voiceStatus"></div>
                </button>
                <button onclick="sendQuestion()" id="sendButton" data-lang-key="send_button">Ï†ÑÏÜ°</button>
            </div>
        </div>
    </div>

    <script>
        // Azure Speech SDK ÌôòÍ≤ΩÎ≥ÄÏàò ÏÑ§Ï†ï
        const AZURE_SPEECH_KEY = '';
        const AZURE_SPEECH_REGION = 'koreacentral';
        
        let currentLang = 'ko';
        let speechRecognizer = null;
        let isListening = false;

        const translations = {
            'ko': {
                'header_title': 'Ïù∏Ï≤úÍµ≠Ï†úÍ≥µÌï≠ AI Ï±óÎ¥á',
                'header_subtitle': 'Ï£ºÏ∞®Ïû• ¬∑ ÏãúÏÑ§ ¬∑ Ìï≠Í≥µÌé∏ Ï†ïÎ≥¥Î•º Ìïú Î≤àÏóê!',
                'tab_all': 'üåü&nbsp;Ï†ÑÏ≤¥ ÏÑúÎπÑÏä§',
                'tab_parking': 'üöó&nbsp;Ï£ºÏ∞®Ïû•',
                'tab_facility': 'üè™&nbsp;ÏãúÏÑ§',
                'tab_flight': '‚úàÔ∏è&nbsp;Ìï≠Í≥µÌé∏',
                'status_text': 'Ïã§ÏãúÍ∞Ñ Ï†ïÎ≥¥ ÏÑúÎπÑÏä§ Ïö¥ÏòÅ Ï§ë',
                'input_placeholder': 'Ïòà: Ï∂úÍµ≠Ïû• ÎÇ¥ ÌïúÏãùÎãπ ÏúÑÏπò Ï†ïÎ≥¥ ',
                'send_button': 'Ï†ÑÏÜ°',
                'voice_listening': 'ÏùåÏÑ± Ïù∏Ïãù Ï§ë...',
                'voice_processing': 'Ï≤òÎ¶¨ Ï§ë...',
                'voice_error': 'ÏùåÏÑ± Ïù∏Ïãù Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
                'voice_not_supported': 'ÏùåÏÑ± Ïù∏ÏãùÏùÑ ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.',
                'voice_permission_denied': 'ÎßàÏù¥ÌÅ¨ Í∂åÌïúÏù¥ Í±∞Î∂ÄÎêòÏóàÏäµÎãàÎã§.',
                'initial_bot_message': `ÏïàÎÖïÌïòÏÑ∏Ïöî! Ïù∏Ï≤úÍµ≠Ï†úÍ≥µÌï≠ ÌÜµÌï© ÏïàÎÇ¥ Ï±óÎ¥áÏûÖÎãàÎã§. üòä

üîπ Ï£ºÏ∞®Ïû• Ï†ïÎ≥¥ (ÌòºÏû°ÎèÑ, ÏûîÏó¨ Í≥µÍ∞Ñ)
üîπ Í≥µÌï≠ ÏãúÏÑ§ ÏïàÎÇ¥ (ÌôòÏ†ÑÏÜå, ÏãùÎãπ, Î©¥ÏÑ∏Ï†ê Îì±)
üîπ Ìï≠Í≥µÌé∏ Ï†ïÎ≥¥ (Ï∂úÎ∞ú/ÎèÑÏ∞© ÏãúÍ∞Ñ, Í≤åÏù¥Ìä∏, ÌòÑÏßÄ ÎÇ†Ïî®)
üîπ Ïó¨Ìñâ Ï§ÄÎπÑÎ¨º Î∞è Í≥µÌï≠ Ïù¥Ïö© ÍøÄÌåÅ

üí¨ ÌÖçÏä§Ìä∏ ÏûÖÎ†• ÎòêÎäî üé§ ÏùåÏÑ± ÏûÖÎ†•ÏúºÎ°ú ÏßàÎ¨∏Ìï¥Î≥¥ÏÑ∏Ïöî!

üí° Ìï≠Í≥µÌé∏ Î≤àÌò∏Î•º Ìï®Íªò ÏûÖÎ†•ÌïòÏãúÎ©¥ Îçî Ï†ïÌôïÌïú Ï†ïÎ≥¥Î•º ÏïåÎ†§ÎìúÎ¶¥ Ïàò ÏûàÏñ¥Ïöî!`
            },
            'en': {
                'header_title': 'Incheon Airport AI Guide',
                'header_subtitle': 'Parking, Facilities, and Flight Info at once!',
                'tab_all': 'üåü&nbsp;All Services',
                'tab_parking': 'üöó&nbsp;Parking',
                'tab_facility': 'üè™&nbsp;Facilities',
                'tab_flight': '‚úàÔ∏è&nbsp;Flights',
                'status_text': 'Real-time information service is running',
                'input_placeholder': 'e.g., Where is the Korean restaurant in the departure lounge? ',
                'send_button': 'Send',
                'voice_listening': 'Listening...',
                'voice_processing': 'Processing...',
                'voice_error': 'Voice recognition error occurred.',
                'voice_not_supported': 'Voice recognition is not supported.',
                'voice_permission_denied': 'Microphone permission denied.',
                'initial_bot_message': `Hello! Welcome to the Incheon Airport AI Guide. üòä

üîπ Parking status (congestion, available spots)  
üîπ Facility info (currency exchange, restaurants, duty-free shops)  
üîπ Flight details (departure/arrival time, gate, weather)  
üîπ Travel tips & preparation checklist  

üí¨ Ask via text or üé§ voice input!

üí° For more accurate results, please include your flight number in your question!`
            },
            'ja': {
                'header_title': '‰ªÅÂ∑ùÂõΩÈöõÁ©∫Ê∏Ø AIÊ°àÂÜÖ',
                'header_subtitle': 'ÈßêËªäÂ†¥„ÉªÊñΩË®≠„Éª„Éï„É©„Ç§„ÉàÊÉÖÂ†±„Çí‰∏ÄÂ∫¶„Å´ÔºÅ',
                'tab_all': 'üåü&nbsp;ÂÖ®„Çµ„Éº„Éì„Çπ',
                'tab_parking': 'üöó&nbsp;ÈßêËªäÂ†¥',
                'tab_facility': 'üè™&nbsp;ÊñΩË®≠',
                'tab_flight': '‚úàÔ∏è&nbsp;„Éï„É©„Ç§„Éà',
                'status_text': '„É™„Ç¢„É´„Çø„Ç§„É†ÊÉÖÂ†±„Çµ„Éº„Éì„ÇπÈÅãÂñ∂‰∏≠',
                'input_placeholder': '‰æã: Âá∫ÂõΩ„Çø„Éº„Éü„Éä„É´ÂÜÖ„ÅÆÈüìÂõΩÊñôÁêÜÂ∫ó„ÅØ„Å©„Åì„Åß„Åô„ÅãÔºü ',
                'send_button': 'ÈÄÅ‰ø°',
                'voice_listening': 'Èü≥Â£∞Ë™çË≠ò‰∏≠...',
                'voice_processing': 'Âá¶ÁêÜ‰∏≠...',
                'voice_error': 'Èü≥Â£∞Ë™çË≠ò„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ',
                'voice_not_supported': 'Èü≥Â£∞Ë™çË≠ò„Åå„Çµ„Éù„Éº„Éà„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ',
                'voice_permission_denied': '„Éû„Ç§„ÇØ„ÅÆÊ®©Èôê„ÅåÊãíÂê¶„Åï„Çå„Åæ„Åó„Åü„ÄÇ',
                'initial_bot_message': `„Åì„Çì„Å´„Å°„ÅØÔºÅ‰ªÅÂ∑ùÂõΩÈöõÁ©∫Ê∏ØAIÊ°àÂÜÖ„ÉÅ„É£„ÉÉ„Éà„Éú„ÉÉ„Éà„Åß„Åô„ÄÇüòä

üîπ ÈßêËªäÂ†¥ÊÉÖÂ†±ÔºàÊ∑∑ÈõëÂ∫¶„ÄÅÁ©∫„Åç„Çπ„Éö„Éº„ÇπÔºâ  
üîπ Á©∫Ê∏ØÊñΩË®≠„ÅÆÊ°àÂÜÖÔºà‰∏°ÊõøÊâÄ„ÄÅ„É¨„Çπ„Éà„É©„É≥„ÄÅÂÖçÁ®éÂ∫ó„Å™„Å©Ôºâ  
üîπ „Éï„É©„Ç§„ÉàÊÉÖÂ†±ÔºàÂá∫Áô∫/Âà∞ÁùÄÊôÇÈñì„ÄÅ„Ç≤„Éº„Éà„ÄÅÂ§©Ê∞óÔºâ  
üîπ ÊóÖË°å„ÅÆÊ∫ñÂÇôÁâ©„ÇÑÁ©∫Ê∏ØÂà©Áî®„ÅÆ„Éí„É≥„Éà  

üí¨ „ÉÜ„Ç≠„Çπ„ÉàÂÖ•Âäõ„Åæ„Åü„ÅØüé§Èü≥Â£∞ÂÖ•Âäõ„ÅßË≥™Âïè„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºÅ

üí° „Éï„É©„Ç§„ÉàÁï™Âè∑„Çí‰∏ÄÁ∑í„Å´ÂÖ•Âäõ„Åô„Çã„Å®„ÄÅ„Çà„ÇäÊ≠£Á¢∫„Å™ÊÉÖÂ†±„Çí„ÅîÊ°àÂÜÖ„Åß„Åç„Åæ„Åô„ÇàÔºÅ`
            },
            'zh': {
                'header_title': '‰ªÅÂ∑ùÂõΩÈôÖÊú∫Âú∫ AIÊåáÂçó',
                'header_subtitle': 'ÂÅúËΩ¶Âú∫„ÄÅËÆæÊñΩ„ÄÅËà™Áè≠‰ø°ÊÅØ‰∏ÄÁ´ôÂºèÊúçÂä°ÔºÅ',
                'tab_all': 'üåü&nbsp;ÊâÄÊúâÊúçÂä°',
                'tab_parking': 'üöó&nbsp;ÂÅúËΩ¶Âú∫',
                'tab_facility': 'üè™&nbsp;ËÆæÊñΩ',
                'tab_flight': '‚úàÔ∏è&nbsp;Ëà™Áè≠',
                'status_text': 'ÂÆûÊó∂‰ø°ÊÅØÊúçÂä°ËøêË°å‰∏≠',
                'input_placeholder': '‰æãÂ¶ÇÔºöÂá∫Â¢ÉÂ§ßÂéÖÈáåÁöÑÈü©È§êÂéÖÂú®Âì™ÈáåÔºü ',
                'send_button': 'ÂèëÈÄÅ',
                'voice_listening': 'ËØ≠Èü≥ËØÜÂà´‰∏≠...',
                'voice_processing': 'Â§ÑÁêÜ‰∏≠...',
                'voice_error': 'ËØ≠Èü≥ËØÜÂà´Âá∫Áé∞ÈîôËØØ„ÄÇ',
                'voice_not_supported': '‰∏çÊîØÊåÅËØ≠Èü≥ËØÜÂà´„ÄÇ',
                'voice_permission_denied': 'È∫¶ÂÖãÈ£éÊùÉÈôêË¢´ÊãíÁªù„ÄÇ',
                'initial_bot_message': `ÊÇ®Â•ΩÔºÅÊ¨¢Ëøé‰ΩøÁî®‰ªÅÂ∑ùÂõΩÈôÖÊú∫Âú∫AIÊåáÂçó üòä

üîπ ÂÅúËΩ¶Âú∫‰ø°ÊÅØÔºàÊã•Â†µÊÉÖÂÜµ„ÄÅÂâ©‰ΩôËΩ¶‰ΩçÔºâ  
üîπ Êú∫Âú∫ËÆæÊñΩÊåáÂçóÔºàÂÖëÊç¢Â§Ñ„ÄÅÈ§êÂéÖ„ÄÅÂÖçÁ®éÂ∫óÁ≠âÔºâ  
üîπ Ëà™Áè≠‰ø°ÊÅØÔºàËµ∑È£û/Âà∞ËææÊó∂Èó¥„ÄÅÁôªÊú∫Âè£„ÄÅÂ§©Ê∞îÔºâ  
üîπ Ë°åÂâçÂáÜÂ§áÂèäÊú∫Âú∫Â∞èË¥¥Â£´  

üí¨ ÈÄöËøáÊñáÂ≠óÊàñüé§ËØ≠Èü≥ËæìÂÖ•ÊèêÈóÆÔºÅ

üí° ËæìÂÖ•Ëà™Áè≠Âè∑ÂèØ‰ª•Ëé∑ÂæóÊõ¥Á≤æÂáÜÁöÑ‰ø°ÊÅØÂì¶ÔºÅ`
            },
            'es': {
                'header_title': 'Gu√≠a IA del Aeropuerto de Incheon',
                'header_subtitle': '¬°Estacionamiento, Instalaciones e Informaci√≥n de Vuelos!',
                'tab_all': 'üåü&nbsp;Todos los Servicios',
                'tab_parking': 'üöó&nbsp;Estacionamiento',
                'tab_facility': 'üè™&nbsp;Instalaciones',
                'tab_flight': '‚úàÔ∏è&nbsp;Vuelos',
                'status_text': 'Servicio de informaci√≥n en tiempo real en funcionamiento',
                'input_placeholder': 'Ej: D√≥nde est√° el restaurante coreano en la sala de embarque? ',
                'send_button': 'Enviar',
                'voice_listening': 'Escuchando...',
                'voice_processing': 'Procesando...',
                'voice_error': 'Error de reconocimiento de voz.',
                'voice_not_supported': 'Reconocimiento de voz no soportado.',
                'voice_permission_denied': 'Permiso de micr√≥fono denegado.',
                'initial_bot_message': `¬°Hola! Bienvenido a la Gu√≠a IA del Aeropuerto de Incheon. üòä

üîπ Informaci√≥n de estacionamiento (congesti√≥n, espacios disponibles)  
üîπ Gu√≠a de instalaciones (casa de cambio, restaurantes, tiendas duty-free)  
üîπ Informaci√≥n de vuelos (hora de salida/llegada, puerta, clima)  
üîπ Consejos para tu viaje y uso del aeropuerto  

üí¨ ¬°Pregunta por texto o üé§ entrada de voz!

üí° ¬°Incluye tu n√∫mero de vuelo para obtener informaci√≥n m√°s precisa!`
            }
        };

        const allQuestions = [
            // Ï†ÑÏ≤¥ ÏÑúÎπÑÏä§ (ÌòºÌï©)
            {
                text: { ko: 'Ï£ºÏ∞®Ïû• + Ï£ºÎ≥Ä ÏãúÏÑ§', en: 'Parking + Nearby Facilities', ja: 'ÈßêËªäÂ†¥+Âë®Ëæ∫ÊñΩË®≠', zh: 'ÂÅúËΩ¶Âú∫+Âë®ËæπËÆæÊñΩ', es: 'Parking + Instalaciones Cercanas' },
                category: 'mixed', emoji: 'üöó',
                question: { ko: 'T1 Îã®Í∏∞Ï£ºÏ∞®Ïû• ÌòÑÏû¨ ÏÉÅÌô©Í≥º Ïö¥ÏòÅ Ï§ëÏù∏ Ï£ºÎ≥Ä ÏãùÎãπ', en: 'Current situation of T1 short-term parking and nearby restaurants', ja: 'T1Áü≠ÊúüÈßêËªäÂ†¥„ÅÆÁèæÂú®„ÅÆÁä∂Ê≥Å„Å®Âñ∂Ê•≠‰∏≠„ÅÆÂë®Ëæ∫„É¨„Çπ„Éà„É©„É≥', zh: 'T1Áü≠ÊúüÂÅúËΩ¶Âú∫Áé∞Áä∂ÂèäÂë®ËæπËê•‰∏öÈ§êÂéÖ', es: 'Situaci√≥n actual del parking de corta estancia de la T1 y restaurantes cercanos' }
            },
            {
                text: { ko: 'Ìï≠Í≥µÌé∏ + ÎÇ†Ïî®', en: 'Flights + Weather', ja: '„Éï„É©„Ç§„Éà+Â§©Ê∞ó', zh: 'Ëà™Áè≠+Â§©Ê∞î', es: 'Vuelos + Clima' },
                category: 'mixed', emoji: 'üå§Ô∏è',
                question: { ko: '7C1301Ìé∏ Ï†ïÎ≥¥ÏôÄ ÎèÑÏ∞©ÏßÄ ÎÇ†Ïî® Ï†ïÎ≥¥', en: '7C1301 flight information and destination weather', ja: '7C1301‰æø„ÅÆÊÉÖÂ†±„Å®ÁõÆÁöÑÂú∞„ÅÆÂ§©Ê∞ó', zh: '7C1301Ëà™Áè≠‰ø°ÊÅØÂíåÁõÆÁöÑÂú∞Â§©Ê∞î‰ø°ÊÅØ', es: 'Informaci√≥n del vuelo 7C1301 y clima en destino' }
            },

            // Ï£ºÏ∞®Ïû•
            {
                text: { ko: 'T1 Îã®Í∏∞Ï£ºÏ∞®Ïû• ÌòÑÏû¨ ÏÉÅÌô©', en: 'T1 Short-term Parking Status', ja: 'T1Áü≠ÊúüÈßêËªäÂ†¥„ÅÆÁèæÂú®„ÅÆÁä∂Ê≥Å', zh: 'T1Áü≠ÊúüÂÅúËΩ¶Âú∫Áé∞Áä∂', es: 'Estado del estacionamiento T1 corto plazo' },
                category: 'parking', emoji: 'üöó',
                question: { ko: 'T1 Îã®Í∏∞Ï£ºÏ∞®Ïû• ÌòÑÏû¨ ÏÉÅÌô©', en: 'Current status of T1 short-term parking', ja: 'T1Áü≠ÊúüÈßêËªäÂ†¥„ÅÆÁèæÂú®„ÅÆÁä∂Ê≥Å', zh: 'T1Áü≠ÊúüÂÅúËΩ¶Âú∫Áé∞Áä∂', es: 'Estado actual del estacionamiento T1 corto plazo' }
            },
            {
                text: { ko: 'Í∞ÄÏû• Ïó¨Ïú†Î°úÏö¥ Ï£ºÏ∞®Ïû•', en: 'Most Available Parking Lot', ja: 'ÊúÄ„ÇÇÁ©∫„ÅÑ„Å¶„ÅÑ„ÇãÈßêËªäÂ†¥', zh: 'ÊúÄÁ©∫Èó≤ÁöÑÂÅúËΩ¶Âú∫', es: 'Estacionamiento m√°s disponible' },
                category: 'parking', emoji: 'üöó',
                question: {ko: "T2 Ïû•Í∏∞Ï£ºÏ∞®Ïû• ÏûîÏó¨ Í≥µÍ∞Ñ", en: "T2 Long-term Parking Lot Availability", ja: "T2Èï∑ÊúüÈßêËªäÂ†¥Á©∫„ÅçÊÉÖÂ†±", zh: "T2ÈïøÊúüÂÅúËΩ¶Âú∫Á©∫‰ΩôËΩ¶‰Ωç", es: "¬øEspacio disponible en el estacionamiento de larga estancia T2?" }
            },

            // ÏãúÏÑ§
            {
                text: { ko: 'ÏïΩÍµ≠ ÏúÑÏπòÏôÄ Ïö¥ÏòÅÏãúÍ∞Ñ', en: 'Pharmacy Info', ja: 'Ëñ¨Â±Ä„ÅÆÂ†¥ÊâÄ„Å®Âñ∂Ê•≠ÊôÇÈñì', zh: 'ËçØÂ∫ó‰ΩçÁΩÆÂíåËê•‰∏öÊó∂Èó¥', es: 'Ubicaci√≥n y horario de farmacias' },
                category: 'facility', emoji: 'üíä',
                question: { ko: 'ÏïΩÍµ≠ ÏúÑÏπòÏôÄ Ïö¥ÏòÅÏãúÍ∞ÑÏùÄ Ïñ¥ÎñªÍ≤å ÎêòÎÇòÏöî?', en: 'Where are the pharmacies and what are their hours?', ja: 'Ëñ¨Â±Ä„ÅÆÂ†¥ÊâÄ„Å®Âñ∂Ê•≠ÊôÇÈñì„ÇíÊïô„Åà„Å¶', zh: 'ËçØÂ∫óÂú®Âì™ÔºüÂá†ÁÇπÂºÄÔºü', es: '¬øD√≥nde est√°n las farmacias y su horario?' }
            },
            {
                text: { ko: 'Ìé∏ÏùòÏ†ê ÏúÑÏπòÏôÄ Ïö¥ÏòÅÏãúÍ∞Ñ', en: 'Convenience Store Info', ja: '„Ç≥„É≥„Éì„Éã„ÅÆÂ†¥ÊâÄ„Å®Âñ∂Ê•≠ÊôÇÈñì', zh: '‰æøÂà©Â∫ó‰ΩçÁΩÆÂíåËê•‰∏öÊó∂Èó¥', es: 'Ubicaci√≥n y horario de tiendas de conveniencia'},
                category: 'facility', emoji: 'üè™',
                question: { ko: 'CU Ìé∏ÏùòÏ†ê ÏúÑÏπòÏôÄ Ïö¥ÏòÅÏãúÍ∞Ñ ÏïåÎ†§Ï§ò', en: 'Where are the CU convenience stores and what are their hours?', ja: '„Ç≥„É≥„Éì„Éã„ÅÆÂ†¥ÊâÄ„Å®Âñ∂Ê•≠ÊôÇÈñì„ÇíÊïô„Åà„Å¶', zh: 'CU‰æøÂà©Â∫óÂú®Âì™ÔºüÂá†ÁÇπÂºÄÔºü', es: '¬øD√≥nde est√°n las tiendas de conveniencia y su horario?' }
            },

            // Ìï≠Í≥µÌé∏
            {
                text: { ko: 'ÎèÑÏ∞©ÏßÄ ÎÇ†Ïî®', en: 'Destination Weather', ja: 'ÁõÆÁöÑÂú∞„ÅÆÂ§©Ê∞ó', zh: 'ÁõÆÁöÑÂú∞Â§©Ê∞î', es: 'Clima en destino' },
                category: 'flight', emoji: 'üå§Ô∏è',
                question: { ko: 'ÎÇò ÏßÄÍ∏à ÌÉÄÏù¥Î≤†Ïù¥Í∞ÄÎäîÎç∞ ÎÇ†Ïî® Ïñ¥Îïå?', en: 'I m going to Taipei, what the weather like?', ja: 'Âè∞Âåó„Å´Ë°å„Åè„Çì„Å†„Åë„Å©Â§©Ê∞ó„ÅØÔºü', zh: 'ÊàëÁé∞Âú®È£ûÂæÄÂè∞ÂåóÔºåÈÇ£ËæπÂ§©Ê∞îÊÄé‰πàÊ†∑Ôºü', es: 'Voy a Taipei, ¬øc√≥mo est√° el clima all√°?' }
            },
            {
                text: { ko: 'Ïò§Îäò ÌõÑÏø†Ïò§Ïπ¥ Í∞ÄÎäî Ìï≠Í≥µÌé∏ Ï†ïÎ≥¥', en: 'Today\'s Flights to Fukuoka', ja: '‰ªäÊó•„ÅÆÁ¶èÂ≤°Ë°å„Åç„Éï„É©„Ç§„ÉàÊÉÖÂ†±', zh: '‰ªäÂ§©ÂâçÂæÄÁ¶èÂÜàÁöÑËà™Áè≠‰ø°ÊÅØ', es: 'Vuelos de hoy a Fukuoka' },
                category: 'flight', emoji: 'üõ´',
                question: { ko: 'Ïò§Îäò ÌõÑÏø†Ïò§Ïπ¥ Í∞ÄÎäî Ìï≠Í≥µÌé∏ Ï†ïÎ≥¥ ÏïåÎ†§Ï§ò', en: 'Can you tell me today\'s flights to Fukuoka?', ja: '‰ªäÊó•„ÅÆÁ¶èÂ≤°Ë°å„Åç„ÅÆ„Éï„É©„Ç§„Éà„ÇíÊïô„Åà„Å¶', zh: 'ÂëäËØâÊàë‰ªäÂ§©È£ûÂæÄÁ¶èÂÜàÁöÑËà™Áè≠‰ø°ÊÅØÂ•ΩÂêóÔºü', es: '¬øCu√°les son los vuelos de hoy a Fukuoka?' }
            }
        ];

        const chatContainer = document.getElementById('chatContainer');
        const questionInput = document.getElementById('questionInput');
        const sendButton = document.getElementById('sendButton');
        const serviceTabs = document.querySelectorAll('.service-tab');
        const quickQuestionsContainer = document.getElementById('quickQuestions');
        const voiceButton = document.getElementById('voiceButton');
        const voiceStatus = document.getElementById('voiceStatus');

        // Azure Speech ÏùåÏÑ± Ïù∏Ïãù Ï¥àÍ∏∞Ìôî
        function initAzureSpeechRecognition() {
            try {
                const speechConfig = SpeechSDK.SpeechConfig.fromSubscription(AZURE_SPEECH_KEY, AZURE_SPEECH_REGION);
                
                // Ïñ∏Ïñ¥Î≥Ñ ÏÑ§Ï†ï
                const langCodes = {
                    'ko': 'ko-KR',
                    'en': 'en-US', 
                    'ja': 'ja-JP',
                    'zh': 'zh-CN',
                    'es': 'es-ES'
                };
                
                speechConfig.speechRecognitionLanguage = langCodes[currentLang] || 'ko-KR';
                
                const audioConfig = SpeechSDK.AudioConfig.fromDefaultMicrophoneInput();
                speechRecognizer = new SpeechSDK.SpeechRecognizer(speechConfig, audioConfig);

                speechRecognizer.recognizing = (s, e) => {
                    console.log('Ïù∏Ïãù Ï§ë:', e.result.text);
                    // Ïã§ÏãúÍ∞Ñ Í≤∞Í≥º ÌëúÏãú (ÏÑ†ÌÉùÏÇ¨Ìï≠)
                    if (e.result.text) {
                        questionInput.value = e.result.text;
                    }
                };

                speechRecognizer.recognized = (s, e) => {
                    if (e.result.reason === SpeechSDK.ResultReason.RecognizedSpeech) {
                        console.log('Ïù∏Ïãù ÏôÑÎ£å:', e.result.text);
                        questionInput.value = e.result.text;

                        speechRecognizer.stopContinuousRecognitionAsync();
                        // ÏùåÏÑ± ÏûÖÎ†• ÏôÑÎ£å ÌõÑ ÏûêÎèôÏúºÎ°ú ÏßàÎ¨∏ Ï†ÑÏÜ°
                        setTimeout(() => {
                            if (e.result.text.trim()) {
                                sendQuestion();
                            }
                        }, 500);
                    }
                    stopVoiceRecognition();
                };

                speechRecognizer.canceled = (s, e) => {
                    console.log('ÏùåÏÑ± Ïù∏Ïãù Ï∑®ÏÜå:', e.reason);
                    let errorMessage = translations[currentLang]['voice_error'];
                    
                    if (e.reason === SpeechSDK.CancellationReason.Error) {
                        if (e.errorDetails.includes('PermissionDenied')) {
                            errorMessage = translations[currentLang]['voice_permission_denied'];
                        }
                    }
                    
                    showErrorMessage(errorMessage);
                    stopVoiceRecognition();
                };

                speechRecognizer.sessionStopped = (s, e) => {
                    console.log('ÏùåÏÑ± Ïù∏Ïãù ÏÑ∏ÏÖò Ï§ëÏßÄ');
                    stopVoiceRecognition();
                };

            } catch (error) {
                console.error('Azure Speech Ï¥àÍ∏∞Ìôî Ïò§Î•ò:', error);
                showErrorMessage(translations[currentLang]['voice_not_supported']);
            }
        }

        function toggleVoiceRecognition() {
            if (!speechRecognizer) {
                showErrorMessage(translations[currentLang]['voice_not_supported']);
                return;
            }

            if (isListening) {
                speechRecognizer.stopContinuousRecognitionAsync();
                stopVoiceRecognition();
            } else {
                try {
                    isListening = true;
                    voiceButton.classList.add('listening');
                    voiceStatus.textContent = translations[currentLang]['voice_listening'];
                    voiceStatus.classList.add('show');
                    
                    // Í∏∞Ï°¥ Ïù∏ÏãùÍ∏∞Í∞Ä ÏûàÏúºÎ©¥ Î®ºÏ†Ä Ï†ïÎ¶¨
                    if (speechRecognizer) {
                        speechRecognizer.stopContinuousRecognitionAsync();
                    }
                    
                    speechRecognizer.startContinuousRecognitionAsync();
                } catch (error) {
                    console.error('ÏùåÏÑ± Ïù∏Ïãù ÏãúÏûë Ïò§Î•ò:', error);
                    showErrorMessage(translations[currentLang]['voice_error']);
                    stopVoiceRecognition();
                }
            }
        }

        function stopVoiceRecognition() {
            isListening = false;
            voiceButton.classList.remove('listening', 'processing');
            voiceStatus.classList.remove('show');
            voiceStatus.textContent = '';
        }

        function showErrorMessage(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        function changeLanguage(lang) {
            currentLang = lang;
            document.documentElement.lang = lang;

            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.getAttribute('data-lang-key');
                if (translations[lang][key]) {
                    element.innerHTML = translations[lang][key];
                }
            });
            
            questionInput.placeholder = translations[lang]['input_placeholder'] || '';
            
            document.querySelectorAll('.lang-icon').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.lang-icon[data-lang='${lang}']`).classList.add('active');

            // Azure Speech Ïñ∏Ïñ¥ ÏÑ§Ï†ï ÏóÖÎç∞Ïù¥Ìä∏
            if (speechRecognizer) {
                speechRecognizer.close();
                initAzureSpeechRecognition();
            }

            localStorage.setItem('airport-lang', lang);
        }

        function renderQuickQuestions(category) {
            quickQuestionsContainer.innerHTML = '';
            const filteredQuestions = category === 'all' 
                ? allQuestions
                : allQuestions.filter(q => q.category === category);

            filteredQuestions.forEach(q => {
                const qDiv = document.createElement('div');
                qDiv.className = `quick-question ${q.category}`;
                qDiv.innerHTML = `<span>${q.emoji}</span> ${q.text[currentLang]}`;
                qDiv.onclick = () => askQuestion(q.question[currentLang]);
                quickQuestionsContainer.appendChild(qDiv);
            });
        }

        serviceTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                serviceTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                renderQuickQuestions(tab.dataset.category);
            });
        });

        function addMessage(content, isUser = false) {
            if (isUser) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message user-message';
                messageDiv.innerHTML = content.replace(/\n/g, '<br>');
                chatContainer.appendChild(messageDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
                return messageDiv;
            } else {
                const wrapper = document.createElement('div');
                wrapper.className = 'bot-message-wrapper';
                const avatar = document.createElement('div');
                avatar.className = 'bot-avatar';
                avatar.innerHTML = '<i class="fas fa-plane"></i>';
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message bot-message';
                messageDiv.innerHTML = content.replace(/\n/g, '<br>');
                wrapper.appendChild(avatar);
                wrapper.appendChild(messageDiv);
                chatContainer.appendChild(wrapper);

                wrapper.scrollIntoView({ behavior: 'smooth', block: 'start' });
                return wrapper;
            }
        }

        function showTypingIndicator() {
            const indicatorContent = `<div class="typing-indicator"><span></span><span></span><span></span></div>`;
            return addMessage(indicatorContent, false);
        }

        async function sendQuestion() {
            const question = questionInput.value.trim();
            if (!question || questionInput.disabled) return;

            addMessage(question, true);
            questionInput.value = '';
            questionInput.disabled = true;
            sendButton.disabled = true;

            const typingMessageWrapper = showTypingIndicator();

            try {
                const response = await fetch('/api/chatbot_rag', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question: question })
                });

                const data = await response.json();
                typingMessageWrapper.remove();

                if (data.status === 'success') {
                    addMessage(data.answer);
                } else {
                    addMessage(`‚ö†Ô∏è Ïò§Î•ò: ${data.message}`);
                }

            } catch (error) {
                if (typingMessageWrapper) typingMessageWrapper.remove();
                console.error('API Ïò§Î•ò:', error);
                addMessage('üòÖ Ï£ÑÏÜ°Ìï©ÎãàÎã§. ÏÑúÎ≤Ñ Ïó∞Í≤∞Ïóê Î¨∏Ï†úÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            } finally {
                questionInput.disabled = false;
                sendButton.disabled = false;
                questionInput.focus();
            }
        }

        function askQuestion(question) {
            if (questionInput.disabled) return;
            questionInput.value = question;
            sendQuestion();
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') sendQuestion();
        }

        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const langFromUrl = urlParams.get('lang');
            const savedLang = langFromUrl || localStorage.getItem('airport-lang') || 'ko';
            
            changeLanguage(savedLang);
            addMessage(translations[currentLang].initial_bot_message);
            
            // Azure Speech ÏùåÏÑ± Ïù∏Ïãù Ï¥àÍ∏∞Ìôî
            initAzureSpeechRecognition();

        });
    </script>
</body>
</html>
